

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pvrpm.core.modules.monitor &mdash; PVRPM 1.5.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> PVRPM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_pvrpm_config.html">Example YAML Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/modules.html">pvrpm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/pvrpm.html">pvrpm package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/pvrpm.core.html">pvrpm.core package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/pvrpm.core.modules.html">pvrpm.core.modules package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">PVRPM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>pvrpm.core.modules.monitor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pvrpm.core.modules.monitor</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">pvrpm.core.enums</span> <span class="kn">import</span> <span class="n">ConfigKeys</span> <span class="k">as</span> <span class="n">ck</span>
<span class="kn">from</span> <span class="nn">pvrpm.core.case</span> <span class="kn">import</span> <span class="n">SamCase</span>
<span class="kn">from</span> <span class="nn">pvrpm.core.utils</span> <span class="kn">import</span> <span class="n">sample</span><span class="p">,</span> <span class="n">get_higher_components</span>


<div class="viewcode-block" id="Monitor"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.Monitor">[docs]</a><span class="k">class</span> <span class="nc">Monitor</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for monitoring types</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Monitor.__init__"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.Monitor.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comp_level_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">case</span><span class="p">:</span> <span class="n">SamCase</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initalizes a monitoring instance</span>

<span class="sd">        Args:</span>
<span class="sd">            level (str): The component level this monitoring is apart of</span>
<span class="sd">            comp_level_df (:obj:`pd.DataFrame`): The component level dataframe containing the simulation data</span>
<span class="sd">            case (:obj:`SamCase`): The SAM case for this simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">comp_level_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_components</span><span class="p">()</span></div>

<div class="viewcode-block" id="Monitor.initialize_components"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.Monitor.initialize_components">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">initialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initalizes monitoring data for all components to be tracked during simulation for this monitor type</span>

<span class="sd">        Note:</span>
<span class="sd">            Updates the underlying dataframes in place</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Monitor.reinitialize_components"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.Monitor.reinitialize_components">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">reinitialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reinitalize components in a dataframe similiar to the inital initalization. Used for when repairs or other things may occur</span>

<span class="sd">        Args:</span>
<span class="sd">            df (:obj:`pd.DataFrame`): The dataframe containing the components to reinitalize</span>

<span class="sd">        Returns:</span>
<span class="sd">            :obj:`pd.DataFrame`: The reinitalized components</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Monitor.update"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.Monitor.update">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a monitoring update for one day in the simulation:</span>

<span class="sd">        Modifies time to detection for components</span>

<span class="sd">        Args:</span>
<span class="sd">            day (int): Current day in the simulation</span>

<span class="sd">        Note:</span>
<span class="sd">            Updates the underlying dataframes in place</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="LevelMonitor"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.LevelMonitor">[docs]</a><span class="k">class</span> <span class="nc">LevelMonitor</span><span class="p">(</span><span class="n">Monitor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines monitoring at a component level</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LevelMonitor.initialize_components"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.LevelMonitor.initialize_components">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">component_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
        <span class="n">monitor_modes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">component_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">failure_modes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">component_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># monitoring times, these will be added to the repair time for each component</span>
        <span class="c1"># basically, the time until each failure is detected</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">monitor_modes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># same monitor mode for every failure</span>
            <span class="n">monitor</span> <span class="o">=</span> <span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">][</span><span class="n">monitor_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">monitor</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">],</span> <span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">])</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">monitor</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">monitor_modes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">failure_ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">failure_modes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;failure_type&quot;</span><span class="p">]]</span>
            <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitor_modes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">failure_ind</span><span class="p">]</span>
            <span class="n">monitor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">sample</span><span class="p">(</span><span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">],</span> <span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">],</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modes</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">monitor</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="LevelMonitor.reinitialize_components"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.LevelMonitor.reinitialize_components">[docs]</a>    <span class="k">def</span> <span class="nf">reinitialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">component_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">]</span>
        <span class="n">monitor_modes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">component_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">failure_modes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">component_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">monitor_modes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># same monitor mode for every failure</span>
            <span class="n">monitor</span> <span class="o">=</span> <span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">][</span><span class="n">monitor_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">monitor_modes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">failure_ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">failure_modes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;failure_type&quot;</span><span class="p">]]</span>
            <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitor_modes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">failure_ind</span><span class="p">]</span>
            <span class="n">monitor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">sample</span><span class="p">(</span><span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">],</span> <span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">],</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modes</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">monitor</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="LevelMonitor.update"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.LevelMonitor.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="CrossLevelMonitor"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.CrossLevelMonitor">[docs]</a><span class="k">class</span> <span class="nc">CrossLevelMonitor</span><span class="p">(</span><span class="n">Monitor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines monitoring across different levels</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CrossLevelMonitor.__init__"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.CrossLevelMonitor.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comp_level_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">case</span><span class="p">:</span> <span class="n">SamCase</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initalizes a cross level monitoring instance</span>

<span class="sd">        Args:</span>
<span class="sd">            level (str): The component level this monitoring is apart of</span>
<span class="sd">            comp_level_df (:obj:`pd.DataFrame`): The component level dataframe containing the simulation data</span>
<span class="sd">            case (:obj:`SamCase`): The SAM case for this simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">comp_level_df</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">top_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">LEVELS</span><span class="p">]</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">))</span>
            <span class="n">num_per_top</span> <span class="o">=</span> <span class="n">get_higher_components</span><span class="p">(</span><span class="n">top_level</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="p">)</span>
            <span class="n">indicies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">/</span> <span class="n">num_per_top</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_bins</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;top_level&quot;</span><span class="p">:</span> <span class="n">top_level</span><span class="p">,</span>
                <span class="s2">&quot;indicies&quot;</span><span class="p">:</span> <span class="n">indicies</span><span class="p">,</span>
                <span class="s2">&quot;bins&quot;</span><span class="p">:</span> <span class="n">bins</span><span class="p">,</span>
                <span class="s2">&quot;num_per_top&quot;</span><span class="p">:</span> <span class="n">num_per_top</span><span class="p">,</span>
            <span class="p">}</span></div>

<div class="viewcode-block" id="CrossLevelMonitor.update_bins"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.CrossLevelMonitor.update_bins">[docs]</a>    <span class="k">def</span> <span class="nf">update_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">indicies</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_higher_components</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_bins</span><span class="p">[</span><span class="s2">&quot;top_level&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="p">,</span>
            <span class="n">start_level_df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_bins</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">][</span><span class="n">indicies</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span></div>

<div class="viewcode-block" id="CrossLevelMonitor.initialize_components"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.CrossLevelMonitor.initialize_components">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">component_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>

        <span class="n">monitor</span> <span class="o">=</span> <span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">],</span> <span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="CrossLevelMonitor.reinitialize_components"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.CrossLevelMonitor.reinitialize_components">[docs]</a>    <span class="k">def</span> <span class="nf">reinitialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">component_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">]</span>
        <span class="n">monitor</span> <span class="o">=</span> <span class="n">component_info</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">]</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="CrossLevelMonitor.update"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.CrossLevelMonitor.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>

        <span class="c1"># fraction failed is number of failed components, no matter if its being repaired, etc</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">failed_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">num_failed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_df</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">]</span>
        <span class="n">global_threshold</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frac_failed</span> <span class="o">=</span> <span class="n">num_failed</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="c1"># only decrement time to detection once failure threshold is met</span>
            <span class="k">if</span> <span class="n">frac_failed</span> <span class="o">&gt;</span> <span class="n">conf</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="p">]:</span>
                <span class="c1"># TODO: compound the failures... later</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">global_threshold</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">global_threshold</span><span class="p">:</span>
            <span class="c1"># TODO: idk how to make this more efficent, if i can reduce this down to just a single iloc or loc, and try to elimate the call to get_higher_components i can bump up run time, cause right now it doubles runtime per realization</span>
            <span class="c1"># first, need to get the proper components of this level under the top monitor level</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_bins</span><span class="p">(</span><span class="n">failed_df</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_bins</span>
            <span class="n">undetected_failed</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">indicies</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="n">get_higher_components</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;top_level&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="p">,</span>
                <span class="n">start_level_df</span><span class="o">=</span><span class="n">undetected_failed</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># calculate failure threshold for each top level monitoring component for the monitoried components</span>
            <span class="n">subtract</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">add</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">prev_cnt</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># here, cnt is the number of failed components per top level component, no matter if its being repaired, etc</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indicies</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
                <span class="c1"># total currently failed regardless of detected, being repaired, etc</span>
                <span class="n">frac_failed</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span>
                <span class="k">if</span> <span class="n">frac_failed</span> <span class="o">&gt;</span> <span class="n">conf</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">]:</span>
                    <span class="n">subtract</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">prev_cnt</span><span class="p">,</span> <span class="n">prev_cnt</span> <span class="o">+</span> <span class="n">cnt</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">add</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">prev_cnt</span><span class="p">,</span> <span class="n">prev_cnt</span> <span class="o">+</span> <span class="n">cnt</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">prev_cnt</span> <span class="o">+=</span> <span class="n">cnt</span>

            <span class="k">if</span> <span class="n">subtract</span><span class="p">:</span>
                <span class="n">undetected_failed</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">subtract</span><span class="p">,</span> <span class="n">undetected_failed</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">)]</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                <span class="n">undetected_failed</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">add</span><span class="p">,</span> <span class="n">undetected_failed</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">undetected_failed</span></div></div>


<div class="viewcode-block" id="IndepMonitor"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.IndepMonitor">[docs]</a><span class="k">class</span> <span class="nc">IndepMonitor</span><span class="p">(</span><span class="n">Monitor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines independent monitoring that is component level independent</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="IndepMonitor.__init__"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.IndepMonitor.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">case</span><span class="p">:</span> <span class="n">SamCase</span><span class="p">,</span>
        <span class="n">comps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">costs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initalizes an independent monitoring instance</span>

<span class="sd">        Args:</span>
<span class="sd">            case (:obj:`SamCase`): The SAM case for this simulation</span>
<span class="sd">            comps (dict): The dataframes for each component level that tracks information during the simulation</span>
<span class="sd">            costs (dict): The dictionary for costs accrued for each component level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comps</span> <span class="o">=</span> <span class="n">comps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">costs</span> <span class="o">=</span> <span class="n">costs</span>

        <span class="c1"># keep track of static monitoring for every level</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">monitor_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">INTERVAL</span> <span class="ow">in</span> <span class="n">monitor_config</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INTERVAL</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indep_monitoring</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;No static monitoring defined for any component level!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IndepMonitor.initialize_components"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.IndepMonitor.initialize_components">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="IndepMonitor.reinitialize_components"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.IndepMonitor.reinitialize_components">[docs]</a>    <span class="k">def</span> <span class="nf">reinitialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="IndepMonitor.update"><a class="viewcode-back" href="../../../../api/pvrpm.core.modules.html#pvrpm.core.modules.monitor.IndepMonitor.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indep_monitoring</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep_monitoring</span> <span class="o">&lt;</span> <span class="mi">1</span>
        <span class="n">current_monitors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep_monitoring</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">current_monitors</span><span class="p">:</span>
            <span class="c1"># static monitoring method commences, instantly detecting all failed components in their specified levels</span>
            <span class="c1"># which have not been detected by other monitoring methods yet.</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">][</span><span class="n">monitor</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LEVELS</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_FAIL</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comps</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()))</span>
                <span class="n">monitor_comps</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span>

                <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">monitor_comps</span>
                <span class="c1"># add cost to total costs (split evenly among all the levels for this day)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">costs</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">day</span><span class="p">]</span> <span class="o">+=</span> <span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LEVELS</span><span class="p">])</span>

            <span class="c1"># reset static monitoring time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indep_monitoring</span><span class="p">[</span><span class="n">monitor</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">][</span><span class="n">monitor</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">INTERVAL</span><span class="p">]</span>

        <span class="c1"># threshold monitoring calculations</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">monitor_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># ignore threshold if the interval was reached for this monitor</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">current_monitors</span> <span class="ow">or</span> <span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">monitor_config</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">threshold</span> <span class="o">=</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="p">]</span>
            <span class="n">failed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LEVELS</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_FAIL</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comps</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="n">failed</span> <span class="o">+=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">failed</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># threshold met, run independent monitor</span>
            <span class="c1"># for levels with interval and threshold, you can reverse engineer the day by taking current day, adding the time to indep monitoring to it, then subtracting the monitor time for the components. then you can take the difference from current day and fail day to get the monitor time</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LEVELS</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_FAIL</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comps</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()))</span>
                <span class="n">monitor_comps</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">monitor_comps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">INTERVAL</span> <span class="ow">in</span> <span class="n">monitor_config</span><span class="p">:</span>
                        <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">day</span> <span class="o">-</span> <span class="p">(</span>
                            <span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">indep_monitoring</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">])</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">day</span> <span class="o">-</span> <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;monitor_times&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span>

                <span class="n">monitor_comps</span><span class="p">[</span><span class="s2">&quot;time_to_detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">monitor_comps</span>
                <span class="c1"># add cost to total costs (split evenly among all the levels for this day)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">costs</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">day</span><span class="p">]</span> <span class="o">+=</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LEVELS</span><span class="p">])</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, FSEC.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>