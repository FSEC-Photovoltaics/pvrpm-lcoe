

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pvrpm.core.case &mdash; PVRPM 1.5.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> PVRPM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../example_pvrpm_config.html">Example YAML Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">pvrpm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/pvrpm.html">pvrpm package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/pvrpm.core.html">pvrpm.core package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/pvrpm.core.modules.html">pvrpm.core.modules package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PVRPM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pvrpm.core.case</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pvrpm.core.case</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">import</span> <span class="nn">PySAM.PySSC</span> <span class="k">as</span> <span class="nn">pssc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pvrpm.core.logger</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">pvrpm.core.exceptions</span> <span class="kn">import</span> <span class="n">CaseError</span>
<span class="kn">from</span> <span class="nn">pvrpm.core.utils</span> <span class="kn">import</span> <span class="n">filename_to_module</span><span class="p">,</span> <span class="n">summarize_dc_energy</span><span class="p">,</span> <span class="n">component_degradation</span>
<span class="kn">from</span> <span class="nn">pvrpm.core.enums</span> <span class="kn">import</span> <span class="n">ConfigKeys</span> <span class="k">as</span> <span class="n">ck</span>


<div class="viewcode-block" id="SamCase"><a class="viewcode-back" href="../../../api/pvrpm.core.html#pvrpm.core.case.SamCase">[docs]</a><span class="k">class</span> <span class="nc">SamCase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SAM Case loader, verifier, and simulation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sam_json_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_realizations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">results_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="n">pssc</span><span class="o">.</span><span class="n">PySSC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;yaml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sam_json_dir</span> <span class="o">=</span> <span class="n">sam_json_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_tracker_coeffs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load_modules</span><span class="p">()</span>

        <span class="c1"># will be calculated after base case simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daylight_hours</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annual_daylight_hours</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_lcoe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_npv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_ac_energy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_annual_energy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dc_energy</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_load</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_tax_cash_flow</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_losses</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;There are errors in the configuration files, see logs.&quot;</span><span class="p">)</span>

        <span class="c1"># override results folder and number of realizations</span>
        <span class="k">if</span> <span class="n">num_realizations</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_REALIZATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_realizations</span>
        <span class="k">if</span> <span class="n">results_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">RESULTS_FOLDER</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_folder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__verify_case</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__verify_config</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__load_config</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;yaml&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a configuration from a YAML or JSON file and returns the dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): String path to the file</span>
<span class="sd">            type (str): One of `yaml` or `json`, specifies the file to load</span>

<span class="sd">        Returns:</span>
<span class="sd">            :obj:`dict`: the data loaded from the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;yaml&quot;</span> <span class="ow">or</span> <span class="nb">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;yml&quot;</span><span class="p">:</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">full_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Theres an error reading the JSON configuration file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">scanner</span><span class="o">.</span><span class="n">ScannerError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Theres an error reading the YAML configuration file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ParserError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Theres an error reading the YAML configuration file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The configuration file at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> couldn&#39;t be found!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">config</span>

    <span class="k">def</span> <span class="nf">__load_modules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the case modules and initalizes them with parameters define in the json</span>

<span class="sd">        Returns:</span>
<span class="sd">            :obj:`dict`: A dictionary containing the loaded and configured modules</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first_module</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sam_json_dir</span><span class="p">,</span> <span class="s2">&quot;*.json&quot;</span><span class="p">)):</span>
            <span class="n">module_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">filename_to_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t find module for file </span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">module</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t find module for file </span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

            <span class="n">module_name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;PySAM.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">first_module</span><span class="p">:</span>
                <span class="n">first_module</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">first_module</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">from_existing</span><span class="p">(</span><span class="n">first_module</span><span class="p">)</span>

            <span class="n">case_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load_config</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">case_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;number_inputs&quot;</span><span class="p">:</span>
                    <span class="n">module</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

            <span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>

        <span class="c1"># final check that required modules are present in this case</span>
        <span class="k">for</span> <span class="n">required</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">required_modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">required</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;PVRPM requires the module &#39;</span><span class="si">{</span><span class="n">required</span><span class="si">}</span><span class="s2">&#39; for the simulation to run properly. Please redefine your case.&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">modules</span>

    <span class="k">def</span> <span class="nf">__verify_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies loaded YAML configuration file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># helper function to check distribution parameters</span>
        <span class="k">def</span> <span class="nf">check_params</span><span class="p">(</span><span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">MEAN</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean parameter for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is missing!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">]</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">WEIBULL</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">STD</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">]</span> <span class="ow">and</span> <span class="n">ck</span><span class="o">.</span><span class="n">SHAPE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;STD or SHAPE parameter for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is missing!&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ck</span><span class="o">.</span><span class="n">EXPON</span> <span class="ow">and</span> <span class="n">ck</span><span class="o">.</span><span class="n">STD</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">PARAM</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;STD parameter for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is missing!&quot;</span><span class="p">)</span>

        <span class="c1"># tracking check</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKING</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKER</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                <span class="s2">&quot;Tracking modules loaded in SAM config but no trackers defined in the PVRPM YML configuration, please make sure it is setup!&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKING</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKER</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                <span class="s2">&quot;No tracking modules loaded by tracker defined in PVRPM configuration, please remove it if not using it.&quot;</span>
            <span class="p">)</span>

        <span class="n">top_level_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">needed_keys</span><span class="p">)</span>
        <span class="n">included_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="n">top_level_keys</span>
        <span class="k">if</span> <span class="n">included_keys</span> <span class="o">!=</span> <span class="n">top_level_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing required configuration options in the PVRPM configuration: </span><span class="si">{</span><span class="n">top_level_keys</span> <span class="o">-</span> <span class="n">included_keys</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_REALIZATION</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;Number of realizations must be greater than or equal to 2!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKING</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_TRACKERS</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;If tracking is defined the number of trackers must be greater than 0!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMBINERS</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;Number of combiners must be greater than 0!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_TRANSFORMERS</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;Number of transformers must be greater than 0!&quot;</span><span class="p">)</span>

        <span class="c1"># static monitoring</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">needed_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">indep_monitor_keys</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">monitor_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">included_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">monitor_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="n">needed_keys</span>
                <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">monitor_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">needed_keys</span> <span class="o">-</span> <span class="n">ck</span><span class="o">.</span><span class="n">INTERVAL</span> <span class="o">-</span> <span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span>
                <span class="k">if</span> <span class="n">included_keys</span> <span class="o">!=</span> <span class="n">needed_keys</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Independent monitoring for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is missing keys </span><span class="si">{</span><span class="n">needed_keys</span> <span class="o">-</span> <span class="n">included_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">INTERVAL</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">monitor_config</span> <span class="ow">and</span> <span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">monitor_config</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Independent monitoring for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is missing the interval and/or global_threshold&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keys in independent monitoring configuration: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LEVELS</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">INTERVAL</span> <span class="ow">in</span> <span class="n">monitor_config</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INTERVAL</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">INDEP_MONITOR</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># cross level monitoring and compounding</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># parse levels in order from lowest -&gt; highest to maintain priority on monitoring</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">compound_levels</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">monitor_component_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">][</span><span class="n">component</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">monitor_component</span><span class="p">,</span> <span class="n">monitor_config</span> <span class="ow">in</span> <span class="n">monitor_component_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">needed_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">compound_keys</span><span class="p">)</span>
                    <span class="n">included_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">monitor_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="n">needed_keys</span>
                    <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">monitor_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">needed_keys</span> <span class="o">-</span> <span class="p">{</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">}</span> <span class="o">-</span> <span class="p">{</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="p">}</span>
                    <span class="k">if</span> <span class="n">included_keys</span> <span class="o">!=</span> <span class="n">needed_keys</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Cross component monitoring under component </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">monitor_component</span><span class="si">}</span><span class="s2"> is missing keys </span><span class="si">{</span><span class="n">needed_keys</span> <span class="o">-</span> <span class="n">included_keys</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="c1"># if monitor_config[ck.COMP_FUNC] not in ck.compound_funcs:</span>
                    <span class="c1">#    raise CaseError(</span>
                    <span class="c1">#        f&quot;Compound function for {component}:{monitor_component} is not a valid function!&quot;</span>
                    <span class="c1">#    )</span>
                    <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keys in cross level monitoring configuration: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="n">monitor_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="ow">and</span> <span class="ow">not</span> <span class="n">monitor_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;You must specify at least </span><span class="si">{</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="si">}</span><span class="s2"> or </span><span class="si">{</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">monitor_component</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">monitor_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_THRESH</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Global failure threshold for </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">monitor_component</span><span class="si">}</span><span class="s2"> must be between 0 and 1.&quot;</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">monitor_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ck</span><span class="o">.</span><span class="n">FAIL_PER_THRESH</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">monitor_component</span><span class="si">}</span><span class="s2"> must be between 0 and 1.&quot;</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">dists</span><span class="p">:</span>
                        <span class="n">check_params</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">monitor_component</span><span class="p">,</span> <span class="n">monitor_config</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">monitor_component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="c1"># add what level is monitoring this component level for compounding later</span>
                        <span class="n">monitor_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LEVELS</span><span class="p">]</span> <span class="o">=</span> <span class="n">component</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">monitor_component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">COMP_MONITOR</span><span class="p">]</span> <span class="o">=</span> <span class="n">monitor_config</span>

        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">component_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>  <span class="c1"># for non-needed components, needed ones checked already above</span>
                <span class="k">continue</span>

            <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">NAME</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_FAIL</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_FAIL</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_REPAIR</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_REPAIR</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_MONITOR</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_MONITOR</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing configurations for component &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_FAIL</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_REPAIR</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">REPAIR</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">REPAIR</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_MONITOR</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing configurations for component &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">WARRANTY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">WARRANTY</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">ck</span><span class="o">.</span><span class="n">DAYS</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">DAYS</span><span class="p">)</span>

            <span class="c1"># check the number of repairs / monitoring is either 1 or equal to number of failures</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_FAIL</span><span class="p">]:</span>  <span class="c1"># in case there are no failures for components that cant fail</span>
                <span class="n">num_failure_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">,</span> <span class="p">{}))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_REPAIR</span><span class="p">]:</span>
                    <span class="n">num_repair_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">REPAIR</span><span class="p">,</span> <span class="p">{}))</span>
                    <span class="k">if</span> <span class="n">num_repair_modes</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">num_repair_modes</span> <span class="o">!=</span> <span class="n">num_failure_modes</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Number of repairs for component &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39; must be 1 or equal to the number of failures&quot;</span>
                        <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_MONITOR</span><span class="p">]:</span>
                    <span class="n">num_monitor_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">,</span> <span class="p">{}))</span>
                    <span class="k">if</span> <span class="n">num_monitor_modes</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">num_monitor_modes</span> <span class="o">!=</span> <span class="n">num_failure_modes</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Number of monitoring modes for component &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39; must be 1 or equal to the number of failures&quot;</span>
                        <span class="p">)</span>
                <span class="c1"># check concurrent failures and repairs</span>
                <span class="n">num_failure_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">PARTIAL_FAIL</span><span class="p">,</span> <span class="p">{}))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_REPAIR</span><span class="p">]:</span>
                    <span class="n">num_repair_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">PARTIAL_REPAIR</span><span class="p">,</span> <span class="p">{}))</span>
                    <span class="k">if</span> <span class="n">num_repair_modes</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">num_repair_modes</span> <span class="o">!=</span> <span class="n">num_failure_modes</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Number of concurrent repairs for component &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39; must be 1 or equal to the number of concurrent failures&quot;</span>
                        <span class="p">)</span>

            <span class="k">for</span> <span class="n">failure</span><span class="p">,</span> <span class="n">fail_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">fails</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">failure_keys</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">INVERTER</span><span class="p">:</span>
                    <span class="c1"># inverters may have cost_per_watt specified instead of cost</span>
                    <span class="n">fails</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">)</span>

                <span class="n">included</span> <span class="o">=</span> <span class="n">fails</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">included</span> <span class="o">!=</span> <span class="n">fails</span><span class="p">:</span>
                    <span class="n">missing</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fails</span> <span class="o">-</span> <span class="n">included</span><span class="p">)</span>

                <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">fails</span> <span class="o">-</span> <span class="p">{</span><span class="n">ck</span><span class="o">.</span><span class="n">FRAC</span><span class="p">,</span> <span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">,</span> <span class="n">ck</span><span class="o">.</span><span class="n">COST_PER_WATT</span><span class="p">,</span> <span class="n">ck</span><span class="o">.</span><span class="n">DECAY_FRAC</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keys in failure configuration </span><span class="si">{</span><span class="n">failure</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">FRAC</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="n">ck</span><span class="o">.</span><span class="n">DECAY_FRAC</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Must specify either `fraction` or `decay_fraction`, not both for &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

                <span class="c1"># update cost for inverters</span>
                <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">INVERTER</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fail_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fail_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST_PER_WATT</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">fail_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST_PER_WATT</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># calculate costs based on cents/watt</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">][</span><span class="n">failure</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">fail_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COST_PER_WATT</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INVERTER_SIZE</span><span class="p">]</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="n">fail_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">dists</span><span class="p">:</span>
                    <span class="n">check_params</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">failure</span><span class="p">,</span> <span class="n">fail_config</span><span class="p">)</span>

            <span class="c1"># partial failure check</span>
            <span class="k">for</span> <span class="n">failure</span><span class="p">,</span> <span class="n">fail_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">PARTIAL_FAIL</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">fails</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">partial_failure_keys</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">INVERTER</span><span class="p">:</span>
                    <span class="c1"># inverters may have cost_per_watt specified instead of cost</span>
                    <span class="n">fails</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">)</span>

                <span class="n">included</span> <span class="o">=</span> <span class="n">fails</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">included</span> <span class="o">!=</span> <span class="n">fails</span><span class="p">:</span>
                    <span class="n">missing</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fails</span> <span class="o">-</span> <span class="n">included</span><span class="p">)</span>

                <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">fails</span> <span class="o">-</span> <span class="p">{</span><span class="n">ck</span><span class="o">.</span><span class="n">FRAC</span><span class="p">,</span> <span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">,</span> <span class="n">ck</span><span class="o">.</span><span class="n">COST_PER_WATT</span><span class="p">,</span> <span class="n">ck</span><span class="o">.</span><span class="n">DECAY_FRAC</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keys in concurrent failure configuration </span><span class="si">{</span><span class="n">failure</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">ck</span><span class="o">.</span><span class="n">FRAC</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="n">ck</span><span class="o">.</span><span class="n">DECAY_FRAC</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Must specify either `fraction` or `decay_fraction`, not both for &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

                <span class="c1"># update cost for inverters</span>
                <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">INVERTER</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fail_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fail_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST_PER_WATT</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">fail_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">COST_PER_WATT</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># calculate costs based on cents/watt</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">PARTIAL_FAIL</span><span class="p">][</span><span class="n">failure</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">COST</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">fail_config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COST_PER_WATT</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INVERTER_SIZE</span><span class="p">]</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="n">fail_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">dists</span><span class="p">:</span>
                    <span class="n">check_params</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">failure</span><span class="p">,</span> <span class="n">fail_config</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">monitor</span><span class="p">,</span> <span class="n">monitor_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">MONITORING</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">monitor_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">monitoring_keys</span><span class="p">)</span>
                <span class="n">included</span> <span class="o">=</span> <span class="n">monitor_</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">monitor_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">included</span> <span class="o">!=</span> <span class="n">monitor_</span><span class="p">:</span>
                    <span class="n">missing</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">monitor_</span> <span class="o">-</span> <span class="n">included</span><span class="p">)</span>

                <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">monitor_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">monitor_</span>
                <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keys in monitoring configuration </span><span class="si">{</span><span class="n">monitor</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">monitor_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">dists</span><span class="p">:</span>
                    <span class="n">check_params</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">monitor</span><span class="p">,</span> <span class="n">monitor_config</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">repair</span><span class="p">,</span> <span class="n">repair_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">REPAIR</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">repairs_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">repair_keys</span><span class="p">)</span>
                <span class="n">included</span> <span class="o">=</span> <span class="n">repairs_</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">repair_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">included</span> <span class="o">!=</span> <span class="n">repairs_</span><span class="p">:</span>
                    <span class="n">missing</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">repairs_</span> <span class="o">-</span> <span class="n">included</span><span class="p">)</span>

                <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">repair_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">repairs_</span>
                <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keys in repair configuration </span><span class="si">{</span><span class="n">repair</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">repair_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">dists</span><span class="p">:</span>
                    <span class="n">check_params</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">repair</span><span class="p">,</span> <span class="n">repair_config</span><span class="p">)</span>

            <span class="c1"># partial repairs</span>
            <span class="k">for</span> <span class="n">repair</span><span class="p">,</span> <span class="n">repair_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">PARTIAL_REPAIR</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">repairs_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">partial_repair_keys</span><span class="p">)</span>
                <span class="n">included</span> <span class="o">=</span> <span class="n">repairs_</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">repair_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">included</span> <span class="o">!=</span> <span class="n">repairs_</span><span class="p">:</span>
                    <span class="n">missing</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">repairs_</span> <span class="o">-</span> <span class="n">included</span><span class="p">)</span>

                <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">repair_config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">repairs_</span>
                <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keys in concurrent repair configuration </span><span class="si">{</span><span class="n">repair</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">repair_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">DIST</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">dists</span><span class="p">:</span>
                    <span class="n">check_params</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">repair</span><span class="p">,</span> <span class="n">repair_config</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing configurations for component &#39;</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">STR_PER_COMBINER</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMBINERS</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_strings</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;There must be an integer number of strings per combiner!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INVERTER_PER_TRANS</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_TRANSFORMERS</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_inverters</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;There must be an integer number of inverters per transformer!&quot;</span><span class="p">)</span>

            <span class="c1"># add the number of each component to its configuration information</span>
            <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">MODULE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_modules</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_strings</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">COMBINER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMBINERS</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">INVERTER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_inverters</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">DISCONNECT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_disconnects</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">TRANSFORMER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_TRANSFORMERS</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">GRID</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="n">ck</span><span class="o">.</span><span class="n">TRACKER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMPONENT</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_TRACKERS</span><span class="p">]</span>

        <span class="c1"># make directory for results if it doesnt exist</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">RESULTS_FOLDER</span><span class="p">],</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKING</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKER</span><span class="p">][</span><span class="n">ck</span><span class="o">.</span><span class="n">CAN_FAIL</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precalculate_tracker_losses</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__verify_case</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies loaded module configuration from SAM and also sets class variables for some information about the case.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># need to check that an LCOE calculator that supports lifetime is used</span>
        <span class="k">for</span> <span class="n">bad_module</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">unusable_lcoe_calcs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bad_module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;LCOE calculator </span><span class="si">{</span><span class="n">bad_module</span><span class="si">}</span><span class="s2"> cannot be used since it doesn&#39;t support lifetime, please fix the calculator in the case.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;en_dc_lifetime_losses&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;en_ac_lifetime_losses&quot;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Lifetime daily DC and AC losses will be overridden for this run.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;om_fixed&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;There is a non-zero value in the fixed annual O&amp;M costs input. These will be overwritten with the new values.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;dc_degradation&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Degradation is set by the PVRPM script, you have entered a non-zero degradation to the degradation input. This script will set the degradation input to zero.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;dc_degradation&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_modules</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_strings</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># assume the number of modules per string is the same for each subarray</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MODULES_PER_STR</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_modules_per_string&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKING</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MULTI_SUBARRAY</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sub</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;subarray</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_enable&quot;</span><span class="p">):</span>  <span class="c1"># subarry 1 is always enabled</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_modules</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;subarray</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_modules_per_string&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;subarray</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_nstrings&quot;</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">num_strings</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;subarray</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_nstrings&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;subarray</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_track_mode&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKING</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MULTI_SUBARRAY</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">inverter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;inverter_model&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inverter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INVERTER_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;inv_snl_paco&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inverter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INVERTER_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;inv_ds_paco&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inverter</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INVERTER_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;inv_pd_paco&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;Unknown inverter model! Should be 0, 1, or 2&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MULTI_SUBARRAY</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKING</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                <span class="s2">&quot;Tracker failures may only be modeled for a system consisting of a single subarray. Exiting simulation.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">TRACKING</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_track_mode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_track_mode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span>
                    <span class="s2">&quot;This script is not configured to run with 2-axis tracking or azimuth-axis tracking systems.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># assume 1 AC disconnect per inverter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_inverters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;inverter_count&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_disconnects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_inverters</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">STR_PER_COMBINER</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_strings</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMBINERS</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">COMBINER_PER_INVERTER</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_COMBINERS</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_inverters</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">INVERTER_PER_TRANS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_inverters</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">NUM_TRANSFORMERS</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LIFETIME_YRS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;analysis_period&quot;</span><span class="p">))</span>

    <span class="c1"># for pickling</span>
<div class="viewcode-block" id="SamCase.__getstate__"><a class="viewcode-back" href="../../../api/pvrpm.core.html#pvrpm.core.case.SamCase.__getstate__">[docs]</a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the case into a dictionary for pickling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;modules&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;ssc&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">state</span></div>

<div class="viewcode-block" id="SamCase.__setstate__"><a class="viewcode-back" href="../../../api/pvrpm.core.html#pvrpm.core.case.SamCase.__setstate__">[docs]</a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the object from a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="n">pssc</span><span class="o">.</span><span class="n">PySSC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load_modules</span><span class="p">()</span></div>

<div class="viewcode-block" id="SamCase.precalculate_tracker_losses"><a class="viewcode-back" href="../../../api/pvrpm.core.html#pvrpm.core.case.SamCase.precalculate_tracker_losses">[docs]</a>    <span class="k">def</span> <span class="nf">precalculate_tracker_losses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Precalculate_tracker_losses calculates an array of coefficients (one for every day of the year) that account for the &quot;benefit&quot; of trackers on that particular day. This is used to determine how much power is lost if a tracker fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_tilt&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;This script can only model tracker failures for 0 degree tilt trackers.&quot;</span><span class="p">)</span>

        <span class="n">user_analysis_period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;analysis_period&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;analysis_period&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;en_ac_lifetime_losses&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;en_dc_lifetime_losses&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
        <span class="n">timeseries_with_tracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;dc_net&quot;</span><span class="p">)</span>

        <span class="c1"># calculate timeseries performance without trackers for one year</span>
        <span class="n">user_tracking_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_track_mode&quot;</span><span class="p">)</span>
        <span class="n">user_azimuth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_azimuth&quot;</span><span class="p">)</span>
        <span class="n">user_tilt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_tilt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_track_mode&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># fixed tilt</span>

        <span class="k">if</span> <span class="n">user_azimuth</span> <span class="o">&gt;</span> <span class="mi">360</span> <span class="ow">or</span> <span class="n">user_azimuth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CaseError</span><span class="p">(</span><span class="s2">&quot;Azimuth must be between 0 and 360. Please adjust the azimuth and try again.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">WORST_TRACKER</span><span class="p">]:</span>
            <span class="c1"># assume worst case tracker gets stuck to north. If axis is north-south, assume gets stuck to west.</span>
            <span class="n">worst_case_az</span> <span class="o">=</span> <span class="n">user_azimuth</span>

            <span class="k">if</span> <span class="n">user_azimuth</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">worst_case_az</span> <span class="o">-=</span> <span class="mi">90</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">worst_case_az</span> <span class="o">+=</span> <span class="mi">90</span>

            <span class="k">if</span> <span class="n">worst_case_az</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">worst_case_az</span> <span class="o">+=</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="n">worst_case_az</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
                <span class="n">worst_case_az</span> <span class="o">-=</span> <span class="mi">360</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_azimuth&quot;</span><span class="p">,</span> <span class="n">worst_case_az</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_tilt&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_rotlim&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># assume average case is that tracker gets stuck flat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_tilt&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
        <span class="n">timeseries_without_tracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;dc_net&quot;</span><span class="p">)</span>

        <span class="c1"># summarize it to daily energy</span>
        <span class="n">sum_with_tracker</span> <span class="o">=</span> <span class="n">summarize_dc_energy</span><span class="p">(</span><span class="n">timeseries_with_tracker</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>
        <span class="n">sum_without_tracker</span> <span class="o">=</span> <span class="n">summarize_dc_energy</span><span class="p">(</span><span class="n">timeseries_without_tracker</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>

        <span class="c1"># calculate daily loss statistics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_tracker_coeffs</span> <span class="o">=</span> <span class="n">sum_without_tracker</span> <span class="o">/</span> <span class="n">sum_with_tracker</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;analysis_period&quot;</span><span class="p">,</span> <span class="n">user_analysis_period</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_track_mode&quot;</span><span class="p">,</span> <span class="n">user_tracking_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_azimuth&quot;</span><span class="p">,</span> <span class="n">user_azimuth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;subarray1_tilt&quot;</span><span class="p">,</span> <span class="n">user_tilt</span><span class="p">)</span></div>

<div class="viewcode-block" id="SamCase.base_case_sim"><a class="viewcode-back" href="../../../api/pvrpm.core.html#pvrpm.core.case.SamCase.base_case_sim">[docs]</a>    <span class="k">def</span> <span class="nf">base_case_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the base case simulation for this case, with no failures and optimal lifetime losses</span>

<span class="sd">        This also sets base case output parameters of this object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lifetime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">LIFETIME_YRS</span><span class="p">]</span>

        <span class="c1"># run the dummy base case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;en_dc_lifetime_losses&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;en_ac_lifetime_losses&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;om_fixed&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">module_degradation_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MODULE</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ck</span><span class="o">.</span><span class="n">DEGRADE</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span>

        <span class="n">degrade</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">component_degradation</span><span class="p">(</span><span class="n">module_degradation_rate</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lifetime</span> <span class="o">*</span> <span class="mi">365</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;en_dc_lifetime_losses&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;dc_lifetime_losses&quot;</span><span class="p">,</span> <span class="n">degrade</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_lcoe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;lcoe_real&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_npv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;npv&quot;</span><span class="p">)</span>

        <span class="c1"># ac energy</span>
        <span class="c1"># remove the first element from cf_energy_net because it is always 0, representing year 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_annual_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;cf_energy_net&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_ac_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;gen&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_dc_energy</span> <span class="o">=</span> <span class="n">summarize_dc_energy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;dc_net&quot;</span><span class="p">),</span> <span class="n">lifetime</span><span class="p">)</span>

        <span class="c1"># other outputs from base case (for graphing)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_tax_cash_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;cf_after_tax_cash_flow&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">loss</span> <span class="ow">in</span> <span class="n">ck</span><span class="o">.</span><span class="n">losses</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_losses</span><span class="p">[</span><span class="n">loss</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_losses</span><span class="p">[</span><span class="n">loss</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># calculate availability using sun hours</span>
        <span class="c1"># contains every hour in the year and whether is sun up, down, sunrise, sunset</span>
        <span class="n">sunup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;sunup&quot;</span><span class="p">)</span>

        <span class="c1"># 0 sun is down, 1 sun is up, 2 surnise, 3 sunset, we only considered sun up (1)</span>
        <span class="n">sunup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sunup</span><span class="p">)</span>

        <span class="c1"># determine the frequency of the data, same as frequncy of supplied weather file</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sunup</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">8760</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">8760</span><span class="p">:</span>
                <span class="n">freq</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">total</span> <span class="o">/=</span> <span class="n">freq</span>

        <span class="c1"># sometimes it gives half hourly or quater hourly data, so just pull out the hourly</span>
        <span class="n">sunup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sunup</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">freq</span><span class="p">],</span> <span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>

        <span class="c1"># zero out every value except where the value is 1 (for sunup)</span>
        <span class="n">sunup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sunup</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sunup</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># sum up daylight hours for each day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daylight_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sunup</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annual_daylight_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daylight_hours</span><span class="p">)</span></div>

<div class="viewcode-block" id="SamCase.simulate"><a class="viewcode-back" href="../../../api/pvrpm.core.html#pvrpm.core.case.SamCase.simulate">[docs]</a>    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes simulations for all modules in this case.</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose (int): 0 for no log messages, 1 for simulation log messages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">ck</span><span class="o">.</span><span class="n">MODULE_ORDER</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="SamCase.value"><a class="viewcode-back" href="../../../api/pvrpm.core.html#pvrpm.core.case.SamCase.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set by string name a module value, without specifying the module the variable resides in.</span>

<span class="sd">        If there is no value provided, the value is returned for the variable name.</span>

<span class="sd">        This will search the module&#39;s data and update the variable if found. If the value is not found in all of the modules, an AttributeError is raised.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the value</span>
<span class="sd">            value (Any, optional): Value to set variable to</span>

<span class="sd">        Returns:</span>
<span class="sd">            Value or the variable if value is None</span>

<span class="sd">        Note:</span>
<span class="sd">            Some modules have the same keys, this function will return the first key found in the module order specified in the configuration. Because of the way modules share data in PySAM, setting the value in the first module will propagate it to the other modules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found or incorrect value datatype in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SamCase.output"><a class="viewcode-back" href="../../../api/pvrpm.core.html#pvrpm.core.case.SamCase.output">[docs]</a>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an output variable by string name, without specifying the module the variable resides in.</span>

<span class="sd">        This will search all of the module&#39;s outputs. If the value is not found in all of the modules, an AttributeError is raised.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the output</span>

<span class="sd">        Returns:</span>
<span class="sd">            The value of the output variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">m_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">m_name</span><span class="p">]</span><span class="o">.</span><span class="n">Outputs</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># in case something else should be done</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># if this happens, value was found but was not set, which in PvSAM raises an exception</span>
                <span class="c1"># so, return None</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output variable </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, FSEC.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>